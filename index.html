<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LuaScriptEditor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.css">
  <!-- Editor Themes -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/material.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/dracula.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/monokai.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/eclipse.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/darcula.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/cobalt.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/base16-dark.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/bespin.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/neat.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/idea.css">

  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/lua/lua.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/addon/edit/closebrackets.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/addon/edit/matchbrackets.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/addon/selection/active-line.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/addon/hint/show-hint.js"></script>

  <style>
    :root {
      --bg-main: #fff6fa;
      --header-bg: #ffcede;
      --editor-wrapper-bg: #ffd9e8;
      --editor-bg: #ffeef4;
      --text-color: #5b1f36;
      --button-bg: #f9b8cc;
      --button-hover: #f7a4bf;
      --border-radius: 12px;
      --gutter-bg: #ffd9e8;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Segoe UI',sans-serif;
      background:var(--bg-main);
      color:var(--text-color);
      overflow:hidden;
    }
    header {
      position:relative;
      background:var(--header-bg);
      padding:14px 20px;
      border-radius:var(--border-radius);
      margin:16px auto 10px;
      max-width:960px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .logo {
      font-size:1.6em;
      font-weight:bold;
    }
    .buttons {
      display:flex;
      gap:10px;
    }
    .buttons button {
      background:var(--button-bg);
      color:var(--text-color);
      border:none;
      border-radius:var(--border-radius);
      padding:8px 16px;
      font-weight:600;
      cursor:pointer;
      transition:background .3s, box-shadow .3s;
      box-shadow:0 1px 3px rgba(0,0,0,0.1);
    }
    .buttons button:hover {
      background:var(--button-hover);
    }
    #settings {
      background:transparent;
      border:none;
      font-size:1.5em;
      cursor:pointer;
    }
    #theme-menu {
      position:absolute;
      top:50%;
      right:50px;
      transform:translateY(-50%);
      display:none;
      background:var(--header-bg);
      border-radius:var(--border-radius);
      box-shadow:0 4px 8px rgba(0,0,0,0.1);
      padding:8px;
    }
    #theme-select {
      padding:6px;
      border-radius:6px;
      border:none;
      font-size:1em;
    }
    #tab-bar {
      display:flex;
      gap:6px;
      padding:8px 20px;
      max-width:960px;
      margin:0 auto 10px;
      flex-wrap:wrap;
    }
    .tab {
      background:var(--button-bg);
      padding:6px 10px;
      border-radius:var(--border-radius);
      font-weight:bold;
      display:flex;
      align-items:center;
      gap:6px;
      box-shadow:0 1px 3px rgba(0,0,0,0.1);
      cursor:pointer;
      transition:background .3s;
    }
    .tab.active {
      background:var(--button-hover);
    }
    .close-tab {
      cursor:pointer;
    }
    #editor-container {
      height:calc(100vh - 180px);
      display:flex;
      justify-content:center;
      align-items:center;
      padding:0 20px 20px;
    }
    .editor-wrapper {
      background:var(--editor-wrapper-bg);
      border-radius:16px;
      width:100%;
      max-width:960px;
      height:100%;
      overflow:hidden;
      box-shadow:0 10px 20px rgba(0,0,0,0.05);
      padding:10px;
    }
    .CodeMirror {
      height:100%;
      font-size:16px;
      background:var(--editor-bg);
      transition:background .3s;
    }
    .CodeMirror-cursor {
      transition:left .1s ease, top .1s ease;
    }
    .CodeMirror-gutters {
      background:var(--gutter-bg)!important;
    }
    .CodeMirror-scroll {
      overflow:auto!important;
      padding-bottom:30px;
    }
    .CodeMirror-code > div:nth-child(odd) {
      background:var(--editor-bg);
    }
    .CodeMirror-code > div:nth-child(even) {
      background:rgba(255,255,255,0.5);
    }
    @media(max-width:768px){
      .buttons{flex-wrap:wrap;justify-content:center;}
      header{flex-direction:column;align-items:flex-start;gap:10px;}
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">LuaScriptEditor</div>
    <div class="buttons">
      <button onclick="copyCode()">Copy</button>
      <button onclick="downloadCode()">Download</button>
      <button onclick="clearCode()">Clear</button>
      <button onclick="addTab()">+ Tab</button>
    </div>
    <button id="settings">⋮</button>
    <div id="theme-menu">
      <select id="theme-select"></select>
    </div>
  </header>

  <div id="tab-bar"></div>

  <div id="editor-container">
    <div class="editor-wrapper">
      <textarea id="code"></textarea>
    </div>
  </div>

  <script>
    const themes = [
      "default","material","monokai","dracula","eclipse","darcula",
      "cobalt","base16-dark","bespin","neat","idea","yeti","twilight",
      "neo","midnight"
    ];
    const themeSelect = document.getElementById("theme-select");
    themes.forEach(t => themeSelect.add(new Option(t, t)));
    themeSelect.onchange = () => editor.setOption("theme", themeSelect.value);

    document.getElementById("settings").onclick = () => {
      const m = document.getElementById("theme-menu");
      m.style.display = m.style.display ? "" : "block";
    };

    let tabs = [], currentTab = 0, editor;

    function initEditor() {
      editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        mode: "lua",
        theme: "material",
        lineNumbers: true,
        styleActiveLine: true,
        autoCloseBrackets: true,
        matchBrackets: true,
        lineWrapping: false
      });
      tabs = [{ name: "Tab 1", content: editor.getValue() }];
      editor.setValue(tabs[0].content);
      renderTabs();
    }

    function renderTabs() {
      const bar = document.getElementById("tab-bar");
      bar.innerHTML = "";
      tabs.forEach((t, i) => {
        const d = document.createElement("div");
        d.className = "tab" + (i === currentTab ? " active" : "");
        d.onclick = () => switchTab(i);
        const n = document.createElement("span"); n.textContent = t.name;
        const c = document.createElement("span"); c.textContent = "×"; c.className="close-tab";
        c.onclick = e => { e.stopPropagation(); closeTab(i); };
        d.append(n, c);
        bar.append(d);
      });
    }

    function switchTab(i) {
      tabs[currentTab].content = editor.getValue();
      currentTab = i;
      editor.setValue(tabs[i].content);
      renderTabs();
    }

    function addTab() {
      tabs.push({ name: `Tab ${tabs.length+1}`, content: "" });
      switchTab(tabs.length - 1);
    }

    function closeTab(i) {
      if (tabs.length === 1) return;
      tabs.splice(i, 1);
      if (currentTab >= i) currentTab = Math.max(0, currentTab - 1);
      editor.setValue(tabs[currentTab].content);
      renderTabs();
    }

    function copyCode() {
      navigator.clipboard.writeText(editor.getValue()).then(()=>alert("Copied"));
    }

    function downloadCode() {
      const b = new Blob([editor.getValue()], {type:"text/plain;charset=utf-8"}),
            u = URL.createObjectURL(b), a = document.createElement("a");
      a.href = u; a.download = "script.lua"; a.click(); URL.revokeObjectURL(u);
    }

    function clearCode() {
      if (confirm("Clear the script?")) editor.setValue("");
    }

    window.onload = initEditor;
  </script>
</body>
</html>
